'use strict';

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var isekai = _interopDefault(require('isekai'));
var express = _interopDefault(require('express'));
var helmet = _interopDefault(require('helmet'));
var fs = _interopDefault(require('fs'));
var commonmark = _interopDefault(require('commonmark'));
var chokidar = _interopDefault(require('chokidar'));
var niceware = _interopDefault(require('niceware'));
var child_process = require('child_process');

var f0 = ({ 
    HTTP,
    SET
}) => {
    SET({
        HTTP: { 
            ...HTTP,
            API: HTTP.use(express.json())
        }
    });
};

var version = "1.0.3";

const last_restart = new Date();
const power_words = (target) => 
    target.
        replace(/(\[.[^\]\[]*\])/ug, `<span class='power_word'>$1</span>`).
        replace(`\${version}`, version).
        replace(`\${server_restart}`, `${last_restart.toLocaleString()} PDT`);

const make_data = ([ markdown, template ]) => {
    const reader = new commonmark.Parser();
    const writer = new commonmark.HtmlRenderer();
    
    const md_data = fs.readFileSync(markdown, `utf-8`);
    const html = writer.render(reader.parse(md_data));
    
    const tp_data = fs.readFileSync(template, `utf-8`);
    
    return power_words(tp_data.replace(`<markdown/>`, html));
};

var f1 = ({
    HTTP,
}) => {
    const {
        MARKDOWN = []
    } = HTTP;

    Object.entries(MARKDOWN).
        forEach(([ 
            path, {
                markdown,
                template
            } 
        ]) => {
            console.log(`[HTTP.MARKDOWN] ${markdown} :> ${path}`);
            const paths = [ `./DATA/${markdown}`, `./DATA/${template}` ];

            let data = make_data(paths);

            chokidar.watch(paths, {
                usePolling: true
            }).
                on(`change`, () => {
                    data = make_data(paths);
                    console.log(`[HTTP.MARKDOWN] UPDATED ${markdown} :> ${path}`);
                });

            HTTP.get(path, (req, res) => {
                res.send(data);
            });
        });
};

var f2 = ({
    HTTP
}) => {
    const {
        REPLY = {}
    } = HTTP;

    Object.entries(REPLY).
        forEach(([ path, response ]) => 
            HTTP.get(path, (res) => 
                res.send(response))
        );
};

var f3 = ({
    HTTP 
}) => {
    const {
        STATIC = {}
    } = HTTP;

    Object.entries(STATIC).
        forEach(([ items_path, http_path ]) => {
            console.log(`[HTTP.STATIC] ${items_path} :> ${http_path}`);
            HTTP.use(http_path, express.static(`./DATA/${items_path}`, {
                dotfiles: `allow`
            }));
        });
};

const res = {};
res["API"] = f0;
res["MD"] = f1;
res["REPLY"] = f2;
res["STATIC"] = f3;

// for express nto to send stack traces
process.env.NODE_ENV = `production`;

var HTTP = ({
    EQUIP
}) => EQUIP({
    HTTP: ({
        HTTP: {
            port = 8080
        },
        SET,
    }) => {
        const app = express();
        app.use(helmet());

        app.listen(port, () => {
            console.log(`[HTTP] Listening on http://localhost:${port}`);
        });

        SET({
            HTTP: app
        });
    },    
    ...res
});

var ZALGO = ({
    HTTP: {
        API,
    },
    SET
}) => {
    const ZALGOS = new Map(Object.entries({
        echo: () => ({
            message: `echo` 
        })
    }));

    const set_zalgo = ({
        zalgo,
        strength = 12,
        handler
    }) => {
        zalgo = zalgo || niceware.generatePassphrase(strength).
            join(` `);

        ZALGOS.set(zalgo, handler);
        
        return zalgo;
    };

    const fire = ({
        zalgo,
        data = {}
    }) => {
        if(!ZALGOS.has(zalgo)) {
            return;
        }

        return ZALGOS.get(zalgo)(data);
    };

    const remove = (zalgo) => {
        ZALGOS.delete(zalgo);
    };

    SET({
        ZALGO: Object.assign(set_zalgo, {
            remove,
            fire,
        })
    });

    API.post(`/zalgo`, ({ body }, res) => {
        res.setHeader(`Content-Type`, `application/json`);

        res.end(JSON.stringify(fire(body) || {}));
    });
};

const do_exec = (cmd) => {
    console.log(`DOING `, cmd);
    const child = child_process.exec(cmd);

    return new Promise(((resolve, reject) => {
        child.addListener(`error`, reject);
        child.addListener(`exit`, resolve);
    }));
};

const runner = async (...tasks) => {
    const cmd = tasks.shift();
    if(!cmd) {
        return;
    }

    await do_exec(cmd);
    
    return runner(...tasks);
};

var ADMIN = ({
    ZALGO,
    ADMIN: {
        zalgo,
    }
}) => {
    const admin_zalgo = ZALGO({
        zalgo,
        strength: 18,
        handler: () => {
            runner(`git pull origin master`, `npm install`, `npm run build`).
                then(() => {
                    process.exit();
                });
            
            return {
                restart: true
            };
        }
    });

    if(!zalgo) {
        return console.log(`[ADMIN] ZALGO: ${admin_zalgo}`);
    } 
        
    console.log(`[ADMIN] STARTED`);
};

isekai.SET({"NODE":{},"HTTP":{"port":8080,"STATIC":{"public":"/"}},"LOG":{"greetings":"Hello, serving ./DATA/public on http://localhost:8080"},"ZALGO":{},"ADMIN":{"zalgo":"restart"}});

isekai.EQUIP({
    HTTP,
    ZALGO,
    ADMIN,
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVsbG8td29ybGQuTk9ERS5qcyIsInNvdXJjZXMiOlsiLi4vU0tJTExTL0hUVFAvU0tJTExTL0FQSS5qcyIsIi4uL1NLSUxMUy9IVFRQL1NLSUxMUy9NRC5qcyIsIi4uL1NLSUxMUy9IVFRQL1NLSUxMUy9SRVBMWS5qcyIsIi4uL1NLSUxMUy9IVFRQL1NLSUxMUy9TVEFUSUMuanMiLCIuLi84NTRkMDVmNDhkODU2N2ZkMDlmZjkwOTMyYzFiZTE5NSIsIi4uL1NLSUxMUy9IVFRQL25vZGUuanMiLCIuLi9TS0lMTFMvWkFMR08vbm9kZS5qcyIsIi4uL1NLSUxMUy9BRE1JTi9ydW5uZXIuanMiLCIuLi9TS0lMTFMvQURNSU4vbm9kZS5qcyIsImhlbGxvLXdvcmxkLmVudHJ5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlxyXG5pbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgKHsgXHJcbiAgICBIVFRQLFxyXG4gICAgU0VUXHJcbn0pID0+IHtcclxuICAgIFNFVCh7XHJcbiAgICAgICAgSFRUUDogeyBcclxuICAgICAgICAgICAgLi4uSFRUUCxcclxuICAgICAgICAgICAgQVBJOiBIVFRQLnVzZShleHByZXNzLmpzb24oKSlcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuIiwiaW1wb3J0IGZzIGZyb20gXCJmc1wiO1xyXG5pbXBvcnQgY29tbW9ubWFyayBmcm9tIFwiY29tbW9ubWFya1wiO1xyXG5pbXBvcnQgY2hva2lkYXIgZnJvbSBcImNob2tpZGFyXCI7XHJcblxyXG5pbXBvcnQgeyB2ZXJzaW9uIH0gZnJvbSBcIi4uLy4uLy4uL3BhY2thZ2UuanNvblwiO1xyXG5cclxuY29uc3QgbGFzdF9yZXN0YXJ0ID0gbmV3IERhdGUoKTtcclxuY29uc3QgcG93ZXJfd29yZHMgPSAodGFyZ2V0KSA9PiBcclxuICAgIHRhcmdldC5cclxuICAgICAgICByZXBsYWNlKC8oXFxbLlteXFxdXFxbXSpcXF0pL3VnLCBgPHNwYW4gY2xhc3M9J3Bvd2VyX3dvcmQnPiQxPC9zcGFuPmApLlxyXG4gICAgICAgIHJlcGxhY2UoYFxcJHt2ZXJzaW9ufWAsIHZlcnNpb24pLlxyXG4gICAgICAgIHJlcGxhY2UoYFxcJHtzZXJ2ZXJfcmVzdGFydH1gLCBgJHtsYXN0X3Jlc3RhcnQudG9Mb2NhbGVTdHJpbmcoKX0gUERUYCk7XHJcblxyXG5jb25zdCBtYWtlX2RhdGEgPSAoWyBtYXJrZG93biwgdGVtcGxhdGUgXSkgPT4ge1xyXG4gICAgY29uc3QgcmVhZGVyID0gbmV3IGNvbW1vbm1hcmsuUGFyc2VyKCk7XHJcbiAgICBjb25zdCB3cml0ZXIgPSBuZXcgY29tbW9ubWFyay5IdG1sUmVuZGVyZXIoKTtcclxuICAgIFxyXG4gICAgY29uc3QgbWRfZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhtYXJrZG93biwgYHV0Zi04YCk7XHJcbiAgICBjb25zdCBodG1sID0gd3JpdGVyLnJlbmRlcihyZWFkZXIucGFyc2UobWRfZGF0YSkpO1xyXG4gICAgXHJcbiAgICBjb25zdCB0cF9kYXRhID0gZnMucmVhZEZpbGVTeW5jKHRlbXBsYXRlLCBgdXRmLThgKTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHBvd2VyX3dvcmRzKHRwX2RhdGEucmVwbGFjZShgPG1hcmtkb3duLz5gLCBodG1sKSk7XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCAoe1xyXG4gICAgSFRUUCxcclxufSkgPT4ge1xyXG4gICAgY29uc3Qge1xyXG4gICAgICAgIE1BUktET1dOID0gW11cclxuICAgIH0gPSBIVFRQO1xyXG5cclxuICAgIE9iamVjdC5lbnRyaWVzKE1BUktET1dOKS5cclxuICAgICAgICBmb3JFYWNoKChbIFxyXG4gICAgICAgICAgICBwYXRoLCB7XHJcbiAgICAgICAgICAgICAgICBtYXJrZG93bixcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlXHJcbiAgICAgICAgICAgIH0gXHJcbiAgICAgICAgXSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW0hUVFAuTUFSS0RPV05dICR7bWFya2Rvd259IDo+ICR7cGF0aH1gKTtcclxuICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBbIGAuL0RBVEEvJHttYXJrZG93bn1gLCBgLi9EQVRBLyR7dGVtcGxhdGV9YCBdO1xyXG5cclxuICAgICAgICAgICAgbGV0IGRhdGEgPSBtYWtlX2RhdGEocGF0aHMpO1xyXG5cclxuICAgICAgICAgICAgY2hva2lkYXIud2F0Y2gocGF0aHMsIHtcclxuICAgICAgICAgICAgICAgIHVzZVBvbGxpbmc6IHRydWVcclxuICAgICAgICAgICAgfSkuXHJcbiAgICAgICAgICAgICAgICBvbihgY2hhbmdlYCwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBtYWtlX2RhdGEocGF0aHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbSFRUUC5NQVJLRE9XTl0gVVBEQVRFRCAke21hcmtkb3dufSA6PiAke3BhdGh9YCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIEhUVFAuZ2V0KHBhdGgsIChyZXEsIHJlcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVzLnNlbmQoZGF0YSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG59O1xyXG5cclxuIiwiZXhwb3J0IGRlZmF1bHQgKHtcclxuICAgIEhUVFBcclxufSkgPT4ge1xyXG4gICAgY29uc3Qge1xyXG4gICAgICAgIFJFUExZID0ge31cclxuICAgIH0gPSBIVFRQO1xyXG5cclxuICAgIE9iamVjdC5lbnRyaWVzKFJFUExZKS5cclxuICAgICAgICBmb3JFYWNoKChbIHBhdGgsIHJlc3BvbnNlIF0pID0+IFxyXG4gICAgICAgICAgICBIVFRQLmdldChwYXRoLCAocmVzKSA9PiBcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKHJlc3BvbnNlKSlcclxuICAgICAgICApO1xyXG59OyIsImltcG9ydCBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCAoe1xyXG4gICAgSFRUUCBcclxufSkgPT4ge1xyXG4gICAgY29uc3Qge1xyXG4gICAgICAgIFNUQVRJQyA9IHt9XHJcbiAgICB9ID0gSFRUUDtcclxuXHJcbiAgICBPYmplY3QuZW50cmllcyhTVEFUSUMpLlxyXG4gICAgICAgIGZvckVhY2goKFsgaXRlbXNfcGF0aCwgaHR0cF9wYXRoIF0pID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYFtIVFRQLlNUQVRJQ10gJHtpdGVtc19wYXRofSA6PiAke2h0dHBfcGF0aH1gKTtcclxuICAgICAgICAgICAgSFRUUC51c2UoaHR0cF9wYXRoLCBleHByZXNzLnN0YXRpYyhgLi9EQVRBLyR7aXRlbXNfcGF0aH1gLCB7XHJcbiAgICAgICAgICAgICAgICBkb3RmaWxlczogYGFsbG93YFxyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfSk7XHJcbn07XHJcblxyXG4iLCJjb25zdCByZXMgPSB7fTtcbmltcG9ydCBmMCBmcm9tIFwiL1VzZXJzL0dhbWVzL1Byb2plY3RzL2lzZWthaS1jb3JlL1NLSUxMUy9IVFRQL1NLSUxMUy9BUEkuanNcIjtcbnJlc1tcIkFQSVwiXSA9IGYwO1xuaW1wb3J0IGYxIGZyb20gXCIvVXNlcnMvR2FtZXMvUHJvamVjdHMvaXNla2FpLWNvcmUvU0tJTExTL0hUVFAvU0tJTExTL01ELmpzXCI7XG5yZXNbXCJNRFwiXSA9IGYxO1xuaW1wb3J0IGYyIGZyb20gXCIvVXNlcnMvR2FtZXMvUHJvamVjdHMvaXNla2FpLWNvcmUvU0tJTExTL0hUVFAvU0tJTExTL1JFUExZLmpzXCI7XG5yZXNbXCJSRVBMWVwiXSA9IGYyO1xuaW1wb3J0IGYzIGZyb20gXCIvVXNlcnMvR2FtZXMvUHJvamVjdHMvaXNla2FpLWNvcmUvU0tJTExTL0hUVFAvU0tJTExTL1NUQVRJQy5qc1wiO1xucmVzW1wiU1RBVElDXCJdID0gZjM7XG5leHBvcnQgZGVmYXVsdCByZXM7IiwiaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcclxuaW1wb3J0IGhlbG1ldCBmcm9tIFwiaGVsbWV0XCI7XHJcblxyXG5pbXBvcnQgc3ViX3NraWxscyBmcm9tIFwiLi9TS0lMTFMvKi5qc1wiO1xyXG5cclxuLy8gZm9yIGV4cHJlc3MgbnRvIHRvIHNlbmQgc3RhY2sgdHJhY2VzXHJcbnByb2Nlc3MuZW52Lk5PREVfRU5WID0gYHByb2R1Y3Rpb25gO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgKHtcclxuICAgIEVRVUlQXHJcbn0pID0+IEVRVUlQKHtcclxuICAgIEhUVFA6ICh7XHJcbiAgICAgICAgSFRUUDoge1xyXG4gICAgICAgICAgICBwb3J0ID0gODA4MFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgU0VULFxyXG4gICAgfSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcclxuICAgICAgICBhcHAudXNlKGhlbG1ldCgpKTtcclxuXHJcbiAgICAgICAgYXBwLmxpc3Rlbihwb3J0LCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbSFRUUF0gTGlzdGVuaW5nIG9uIGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fWApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBTRVQoe1xyXG4gICAgICAgICAgICBIVFRQOiBhcHBcclxuICAgICAgICB9KTtcclxuICAgIH0sICAgIFxyXG4gICAgLi4uc3ViX3NraWxsc1xyXG59KTtcclxuIiwiaW1wb3J0IG5pY2V3YXJlIGZyb20gXCJuaWNld2FyZVwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgKHtcclxuICAgIEhUVFA6IHtcclxuICAgICAgICBBUEksXHJcbiAgICB9LFxyXG4gICAgU0VUXHJcbn0pID0+IHtcclxuICAgIGNvbnN0IFpBTEdPUyA9IG5ldyBNYXAoT2JqZWN0LmVudHJpZXMoe1xyXG4gICAgICAgIGVjaG86ICgpID0+ICh7XHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IGBlY2hvYCBcclxuICAgICAgICB9KVxyXG4gICAgfSkpO1xyXG5cclxuICAgIGNvbnN0IHNldF96YWxnbyA9ICh7XHJcbiAgICAgICAgemFsZ28sXHJcbiAgICAgICAgc3RyZW5ndGggPSAxMixcclxuICAgICAgICBoYW5kbGVyXHJcbiAgICB9KSA9PiB7XHJcbiAgICAgICAgemFsZ28gPSB6YWxnbyB8fCBuaWNld2FyZS5nZW5lcmF0ZVBhc3NwaHJhc2Uoc3RyZW5ndGgpLlxyXG4gICAgICAgICAgICBqb2luKGAgYCk7XHJcblxyXG4gICAgICAgIFpBTEdPUy5zZXQoemFsZ28sIGhhbmRsZXIpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB6YWxnbztcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgZmlyZSA9ICh7XHJcbiAgICAgICAgemFsZ28sXHJcbiAgICAgICAgZGF0YSA9IHt9XHJcbiAgICB9KSA9PiB7XHJcbiAgICAgICAgaWYoIVpBTEdPUy5oYXMoemFsZ28pKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBaQUxHT1MuZ2V0KHphbGdvKShkYXRhKTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcmVtb3ZlID0gKHphbGdvKSA9PiB7XHJcbiAgICAgICAgWkFMR09TLmRlbGV0ZSh6YWxnbyk7XHJcbiAgICB9O1xyXG5cclxuICAgIFNFVCh7XHJcbiAgICAgICAgWkFMR086IE9iamVjdC5hc3NpZ24oc2V0X3phbGdvLCB7XHJcbiAgICAgICAgICAgIHJlbW92ZSxcclxuICAgICAgICAgICAgZmlyZSxcclxuICAgICAgICB9KVxyXG4gICAgfSk7XHJcblxyXG4gICAgQVBJLnBvc3QoYC96YWxnb2AsICh7IGJvZHkgfSwgcmVzKSA9PiB7XHJcbiAgICAgICAgcmVzLnNldEhlYWRlcihgQ29udGVudC1UeXBlYCwgYGFwcGxpY2F0aW9uL2pzb25gKTtcclxuXHJcbiAgICAgICAgcmVzLmVuZChKU09OLnN0cmluZ2lmeShmaXJlKGJvZHkpIHx8IHt9KSk7XHJcbiAgICB9KTtcclxufTsiLCJpbXBvcnQgeyBleGVjIH0gZnJvbSBcImNoaWxkX3Byb2Nlc3NcIjtcclxuXHJcbmNvbnN0IGRvX2V4ZWMgPSAoY21kKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhgRE9JTkcgYCwgY21kKTtcclxuICAgIGNvbnN0IGNoaWxkID0gZXhlYyhjbWQpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIGNoaWxkLmFkZExpc3RlbmVyKGBlcnJvcmAsIHJlamVjdCk7XHJcbiAgICAgICAgY2hpbGQuYWRkTGlzdGVuZXIoYGV4aXRgLCByZXNvbHZlKTtcclxuICAgIH0pKTtcclxufTtcclxuXHJcbmNvbnN0IHJ1bm5lciA9IGFzeW5jICguLi50YXNrcykgPT4ge1xyXG4gICAgY29uc3QgY21kID0gdGFza3Muc2hpZnQoKTtcclxuICAgIGlmKCFjbWQpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgZG9fZXhlYyhjbWQpO1xyXG4gICAgXHJcbiAgICByZXR1cm4gcnVubmVyKC4uLnRhc2tzKTtcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHJ1bm5lcjtcclxuIiwiaW1wb3J0IHJ1bm5lciBmcm9tIFwiLi9ydW5uZXIuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0ICh7XHJcbiAgICBaQUxHTyxcclxuICAgIEFETUlOOiB7XHJcbiAgICAgICAgemFsZ28sXHJcbiAgICB9XHJcbn0pID0+IHtcclxuICAgIGNvbnN0IGFkbWluX3phbGdvID0gWkFMR08oe1xyXG4gICAgICAgIHphbGdvLFxyXG4gICAgICAgIHN0cmVuZ3RoOiAxOCxcclxuICAgICAgICBoYW5kbGVyOiAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJ1bm5lcihgZ2l0IHB1bGwgb3JpZ2luIG1hc3RlcmAsIGBucG0gaW5zdGFsbGAsIGBucG0gcnVuIGJ1aWxkYCkuXHJcbiAgICAgICAgICAgICAgICB0aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHJlc3RhcnQ6IHRydWVcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZighemFsZ28pIHtcclxuICAgICAgICByZXR1cm4gY29uc29sZS5sb2coYFtBRE1JTl0gWkFMR086ICR7YWRtaW5femFsZ299YCk7XHJcbiAgICB9IFxyXG4gICAgICAgIFxyXG4gICAgY29uc29sZS5sb2coYFtBRE1JTl0gU1RBUlRFRGApO1xyXG59O1xyXG4iLCJpbXBvcnQgaXNla2FpIGZyb20gXCJpc2VrYWlcIjtcclxuaXNla2FpLlNFVCh7XCJOT0RFXCI6e30sXCJIVFRQXCI6e1wicG9ydFwiOjgwODAsXCJTVEFUSUNcIjp7XCJwdWJsaWNcIjpcIi9cIn19LFwiTE9HXCI6e1wiZ3JlZXRpbmdzXCI6XCJIZWxsbywgc2VydmluZyAuL0RBVEEvcHVibGljIG9uIGh0dHA6Ly9sb2NhbGhvc3Q6ODA4MFwifSxcIlpBTEdPXCI6e30sXCJBRE1JTlwiOntcInphbGdvXCI6XCJyZXN0YXJ0XCJ9fSk7XHJcblxyXG5pbXBvcnQgSFRUUCBmcm9tIFwiLi4vU0tJTExTL0hUVFAvbm9kZS5qc1wiO1xyXG5pbXBvcnQgWkFMR08gZnJvbSBcIi4uL1NLSUxMUy9aQUxHTy9ub2RlLmpzXCI7XHJcbmltcG9ydCBBRE1JTiBmcm9tIFwiLi4vU0tJTExTL0FETUlOL25vZGUuanNcIjtcclxuXG5pc2VrYWkuRVFVSVAoe1xyXG4gICAgSFRUUCxcclxuICAgIFpBTEdPLFxyXG4gICAgQURNSU4sXHJcbn0pO1xyXG4iXSwibmFtZXMiOlsic3ViX3NraWxscyIsImV4ZWMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFHQSxTQUFlLENBQUM7SUFDWixJQUFJO0lB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
